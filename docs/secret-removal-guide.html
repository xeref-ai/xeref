<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GitHub Push Protection & Secret Removal Guide</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            background-color: #F8F5F2; /* Warm Neutral Background */
            color: #434242; /* Dark, readable text */
        }
        .accent-color { color: #E57373; }
        .accent-bg { background-color: #E57373; }
        .accent-bg-hover:hover { background-color: #EF9A9A; }
        .secondary-bg { background-color: #FFFFFF; }
        .code-bg { background-color: #EFEBE9; }
        .border-color { border-color: #D7CCC8; }
        .subtle-text { color: #795548; }
        details > summary { list-style: none; }
        details > summary::-webkit-details-marker { display: none; }
        details[open] summary .chevron { transform: rotate(90deg); }
        .step-circle {
            background-color: #F8F5F2;
            border: 2px solid #D7CCC8;
            color: #795548;
        }
        .step-line {
            background-color: #D7CCC8;
        }
    </style>
</head>
<body class="font-sans antialiased">
    <main class="container mx-auto px-4 sm:px-6 lg:px-8 py-12 md:py-16">

        <!-- Hero Section -->
        <header class="text-center max-w-3xl mx-auto mb-16">
            <h1 class="text-4xl md:text-5xl font-bold tracking-tight mb-4">You've Pushed a Secret to GitHub.</h1>
            <p class="text-lg md:text-xl subtle-text">GitHub's push protection has blocked your commit. This interactive guide will walk you through permanently removing the sensitive file from your entire Git history and teach you how to prevent it from happening again.</p>
            <div class="mt-8 flex justify-center gap-4">
                <button onclick="document.getElementById('interactive-guide').scrollIntoView({ behavior: 'smooth' });" class="px-8 py-3 font-semibold text-white rounded-lg accent-bg accent-bg-hover transition-colors">
                    Start Cleanup Guide
                </button>
            </div>
        </header>

        <div class="lg:grid lg:grid-cols-3 lg:gap-12">
            
            <!-- Interactive Guide (Main Column) -->
            <div id="interactive-guide" class="lg:col-span-2">
                <h2 class="text-3xl font-bold mb-2">Interactive Cleanup: `git-filter-repo`</h2>
                <p class="subtle-text mb-8">This is the recommended and safest method. Follow these steps precisely in a new, temporary directory to rewrite your repository's history.</p>

                <div class="relative pl-8">
                    <!-- Step 1 -->
                    <div class="relative mb-8">
                        <div class="absolute top-0 left-0 -translate-x-1/2 w-8 h-8 rounded-full flex items-center justify-center font-bold text-lg step-circle z-10">1</div>
                        <div class="absolute top-4 left-[-2px] w-0.5 h-full step-line"></div>
                        <div class="bg-white p-6 rounded-lg border border-color shadow-sm">
                            <h3 class="text-xl font-semibold mb-2">Create a Fresh, Bare Clone</h3>
                            <p class="subtle-text mb-4">`git-filter-repo` requires a "fresh clone" to operate safely. A `--bare` clone is a clean copy of your repository's data without a working directory, which is ideal for this operation.</p>
                            <div class="code-block relative code-bg p-4 rounded-md text-sm">
                                <button class="copy-btn absolute top-2 right-2 p-1.5 rounded-md hover:bg-gray-300 transition-colors" title="Copy code">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path></svg>
                                </button>
                                <pre><code>git clone --bare https://github.com/xeref-ai/xeref.git
cd xeref.git</code></pre>
                            </div>
                        </div>
                    </div>

                    <!-- Step 2 -->
                    <div class="relative mb-8">
                        <div class="absolute top-0 left-0 -translate-x-1/2 w-8 h-8 rounded-full flex items-center justify-center font-bold text-lg step-circle z-10">2</div>
                        <div class="absolute top-4 left-[-2px] w-0.5 h-full step-line"></div>
                        <div class="bg-white p-6 rounded-lg border border-color shadow-sm">
                            <h3 class="text-xl font-semibold mb-2">Run `git-filter-repo`</h3>
                            <p class="subtle-text mb-4">Execute the command to remove the `.env.local` file from every commit across all branches in your repository's history. The `--invert-paths` flag removes the specified path.</p>
                            <div class="code-block relative code-bg p-4 rounded-md text-sm">
                                <button class="copy-btn absolute top-2 right-2 p-1.5 rounded-md hover:bg-gray-300 transition-colors" title="Copy code">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path></svg>
                                </button>
                                <pre><code>git filter-repo --path .env.local --invert-paths</code></pre>
                            </div>
                        </div>
                    </div>

                    <!-- Step 3 -->
                    <div class="relative mb-8">
                        <div class="absolute top-0 left-0 -translate-x-1/2 w-8 h-8 rounded-full flex items-center justify-center font-bold text-lg step-circle z-10">3</div>
                        <div class="absolute top-4 left-[-2px] w-0.5 h-full step-line"></div>
                        <div class="bg-white p-6 rounded-lg border border-color shadow-sm">
                            <h3 class="text-xl font-semibold mb-2">Force Push the Cleaned History</h3>
                            <p class="subtle-text mb-4">This operation rewrites your Git history, so a normal push will be rejected. You must force push to overwrite the remote repository with your cleaned version. This is a destructive action, so be certain before proceeding.</p>
                            <div class="code-block relative code-bg p-4 rounded-md text-sm">
                                <button class="copy-btn absolute top-2 right-2 p-1.5 rounded-md hover:bg-gray-300 transition-colors" title="Copy code">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path></svg>
                                </button>
                                <pre><code>git push --force --all origin
git push --force --tags origin</code></pre>
                            </div>
                        </div>
                    </div>

                     <!-- Step 4 -->
                    <div class="relative">
                        <div class="absolute top-0 left-0 -translate-x-1/2 w-8 h-8 rounded-full flex items-center justify-center font-bold text-lg step-circle z-10">4</div>
                        <div class="bg-white p-6 rounded-lg border border-color shadow-sm">
                            <h3 class="text-xl font-semibold mb-2">Clean Up and Inform Your Team</h3>
                            <p class="subtle-text mb-4">The history rewrite is complete. It is now critical that all team members delete their local copies and re-clone the repository to avoid accidentally re-introducing the sensitive file from their old history.</p>
                            <div class="mt-4 p-4 bg-red-50 border border-red-200 text-red-800 rounded-lg">
                                <strong class="font-bold">Important:</strong> All collaborators must fetch the rewritten history and rebase their local branches. The simplest way is to delete their local repository and clone it again.
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Sidebar -->
            <aside class="mt-16 lg:mt-0">
                <div class="sticky top-8 space-y-6">
                    <h3 class="text-2xl font-bold">Reference & Prevention</h3>
                    <!-- Best Practices -->
                    <details class="bg-white p-4 rounded-lg border border-color shadow-sm">
                        <summary class="flex justify-between items-center cursor-pointer font-semibold">
                            Best Practices
                            <span class="chevron transition-transform">▸</span>
                        </summary>
                        <div class="mt-4 pt-4 border-t border-color text-sm space-y-3 subtle-text">
                            <p><strong>Use `.gitignore`:</strong> Add `.env.local` and other secret files to your `.gitignore` file immediately to prevent them from ever being staged.</p>
                            <p><strong>Environment Variables:</strong> Use deployment platform environment variables (like in Vercel, Netlify, or GitHub Actions) to store secrets. They are injected at build time, not stored in Git.</p>
                             <p><strong>Secret Management Tools:</strong> For team projects, use a service like HashiCorp Vault, AWS Secrets Manager, or Google Secret Manager.</p>
                        </div>
                    </details>
                    
                    <!-- Alternative Methods -->
                    <details class="bg-white p-4 rounded-lg border border-color shadow-sm">
                        <summary class="flex justify-between items-center cursor-pointer font-semibold">
                            Alternative Methods
                             <span class="chevron transition-transform">▸</span>
                        </summary>
                        <div class="mt-4 pt-4 border-t border-color text-sm space-y-4 subtle-text">
                           <div>
                                <strong>Using `git filter-branch` (Legacy):</strong>
                                <p>This is the older, slower method but can be reliable. Use with caution.</p>
                                <div class="code-block relative code-bg p-4 rounded-md text-sm mt-2">
                                    <button class="copy-btn absolute top-2 right-2 p-1.5 rounded-md hover:bg-gray-300 transition-colors" title="Copy code">
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path></svg>
                                    </button>
                                    <pre><code>git filter-branch --force --index-filter \
  "git rm --cached --ignore-unmatch .env.local" \
  --prune-empty --tag-name-filter cat -- --all</code></pre>
                                </div>
                           </div>
                           <div>
                                <strong>Bypass Push Protection (Temporary):</strong>
                                <p>If you must push immediately, you can bypass the block. Follow the URL in the error message from GitHub. This is not a fix and the secret will remain in your history. <strong class="text-red-600">This is highly discouraged.</strong></p>
                           </div>
                        </div>
                    </details>
                    
                     <!-- Security Actions -->
                    <details class="bg-white p-4 rounded-lg border border-color shadow-sm">
                        <summary class="flex justify-between items-center cursor-pointer font-semibold">
                            Critical Security Actions
                             <span class="chevron transition-transform">▸</span>
                        </summary>
                        <div class="mt-4 pt-4 border-t border-color text-sm space-y-3 subtle-text">
                            <p><strong>Revoke the Secret:</strong> Immediately go to your OpenAI dashboard (or wherever the secret is from) and revoke the exposed API key. Generate a new one.</p>
                            <p><strong>Review Access Logs:</strong> Check the usage logs for the exposed key to see if it was accessed by any unauthorized parties.</p>
                        </div>
                    </details>

                </div>
            </aside>
        </div>
    </main>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const copyButtons = document.querySelectorAll('.copy-btn');
            copyButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const codeBlock = button.nextElementSibling;
                    const code = codeBlock.textContent;
                    
                    const textarea = document.createElement('textarea');
                    textarea.value = code;
                    document.body.appendChild(textarea);
                    textarea.select();
                    document.execCommand('copy');
                    document.body.removeChild(textarea);

                    const originalTitle = button.title;
                    button.title = 'Copied!';
                    setTimeout(() => {
                        button.title = originalTitle;
                    }, 2000);
                });
            });
        });
    </script>
</body>
</html>
